# 2025년 티맵모빌리티 주요 성과

---

## 추가 개선 필요 사항

| 섹션 | 상태 | 비고 |
|------|------|------|
| Offset Rewind 이슈 | ✅ 완료 | 일 1,000만건, 400만건 영향, 10년 레거시, 99.9% 달성 |
| 운전점수 2.0 | ⏸️ 제외 | 진행 중 |
| 라이브러리 개발 | ✅ 완료 | 4개 프로젝트, 옵션 B 적용 |
| CS 비용 절감 | ✅ 완료 | 월 500만원 절감, 처리시간 50% 단축 |
| 맵매칭 안정화 | ✅ 완료 | VOC 월 10건 → 0건 |
| 에이닷 연동 | ⏸️ 제외 | Airflow 경험 부족 |

---

## 운전습관 Flink Kafka Offset Rewind 정합성 이슈 해결

• 장애 복구 시 Kafka Offset Rewind를 수행하면 일 1,000만 건 중 40%(400만 건)의 주행 데이터가 비정상적으로 재생성되는 문제 발생
• 10년간 해결되지 않아 장애 복구가 사실상 불가능했던 레거시 이슈
• 로컬 환경에서 재현 불가하여 별도 테스트 환경(stg-test) 구축, DynamoDB 대신 RDB를 사용해 쿼리 기반 정합성 검증 체계 마련
• 운영 MSK의 3일 리텐션 제약으로 테스트 기간이 부족해, 리텐션 무제한의 신규 MSK 클러스터 구축
• 원인 분석: Kafka 파티션 90개를 Flink Consumer 50개가 처리하면서, 1개 Consumer가 2개 파티션 담당 시 Watermark가 빠른 파티션 기준으로 생성되어 다른 파티션 데이터가 late data로 drop
• Flink Watermark 설정 수정으로 문제 해결, 장애 복구 시 데이터 정합성 99.9% 달성

## 운전점수 2.0 개발 및 무중단 마이그레이션 *(진행 중 - 이력서 제외)*

• 신규 운전점수 로직 검증을 위해 기존 유저 10% 샘플링 데이터 추출 후 데이터 엔지니어와 협업하여 시뮬레이션 환경 구축
• 운영 데이터를 MSK Consumer를 통해 테스트 환경으로 전달하는 파이프라인 구성, 특정 기간 동안 신규 로직 검증 가능
• 1.0에서 2.0으로 사용자 인지 없이 점진적 마이그레이션 설계 및 진행 중

## 운전점수 공통 라이브러리 개발

• MSA 구조로 인해 다수 프로젝트에서 동일한 운전점수 로직을 중복 구현하는 문제 발생
• `com.tmapmobility.score:driving-score` 라이브러리로 로직 모듈화
• 운전점수 2.0 적용 시 라이브러리 버전 업데이트만으로 전체 프로젝트 일괄 적용, 개발 및 배포 효율성 대폭 향상

## 운전습관 CS 처리 비용 절감

• VOC 대응 시 Superset 질의 및 Airflow DAG 가공 비용이 지속 발생하는 구조적 문제
• 기존 흐름: raw 데이터 → S3 적재 → Airflow 가공 → Athena 적재 → Superset 질의
• 스퀘어어드민에서 위반요소 상세 정보를 직접 조회할 수 있도록 개선
• 월 500만원 인프라 비용 절감, CS 처리 시간 2분 → 1분으로 50% 단축
• Kafka 메시지 크기 증가로 인한 Flink 장애 발생 (기본 1MB 제한 초과), 메시지 크기 설정 조정으로 해결

## 운전습관 Flink 로컬 디버깅 환경 구축

• VOC 발생 시 대량의 GPS raw 데이터를 수작업으로 분석해야 하는 비효율적인 상황
• IDE 기반 로컬 환경 구축 및 사용자 GPS 데이터 리플레이 테스트 환경 최초 구성
• VOC 건당 처리 시간 20분 → 2분으로 단축 (90% 개선)

## 운전습관 Flink 맵매칭 로직 안정화

• GPS-MapLink 매칭 로직 버그로 인한 주행 이력 미생성 문제 발생 (월 10건 VOC 인입)
• 터널 진입 시 GPS 미수신으로 직전 맵링크에 매칭되어 잘못된 과속 위반 검출
• 주행 시작 시 39km 이상 떨어진 맵링크에 매칭되어 이후 주행 이력 미생성
• 맵매칭 거리 메트릭 생성 및 MAX_MATCH_DISTANCE 파라미터 도입
• 터널 구간 위반검출 제외 로직 및 초기 매칭 거리 제한 로직 추가
• 주행 이력 미생성 관련 VOC 월 10건 → 0건으로 완전 해소

## 에이닷 주행 이력 연동 *(이력서 제외)*

• SKT 에이닷 AI 기능 활용을 위해 동의 사용자의 일별 주행 이력 제공 필요
• Airflow DAG 개발로 동의 사용자 주행 이력을 S3에 일별 적재하는 파이프라인 구축
